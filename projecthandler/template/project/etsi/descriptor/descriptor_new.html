{% extends "base.html" %}

{% load staticfiles %}

{% block head_block %}
  	{{ block.super }}


    <!-- Codemirror core CSS -->
    <link rel="stylesheet" href="{% static "codemirror/lib/codemirror.css" %}">
    <link rel="stylesheet" href="{% static "codemirror/addon/fold/foldgutter.css" %}" />
    <link rel="stylesheet" href="{% static "codemirror/theme/neat.css" %}">
    <link rel="stylesheet" href="{% static "codemirror/addon/dialog/dialog.css" %}">
    <link rel="stylesheet" href="{% static "codemirror/addon/display/fullscreen.css" %}">

    <link rel="stylesheet" href="{% static "AdminLTE/plugins/select2/select2.css" %}">
{% endblock %}

{% block left_sidebar %}
    {% include 'project_base_left_sidebar.html' %}
{% endblock %}

{% block breadcrumb_body %}
  	{{ block.super }}
    <li><a href="{% url 'projects:open_project' project_id=project_id %}">Project {{project_id}}</a></li>
    <li><a href="{% url 'projects:open_project' project_id=project_id %}descriptors/{{descriptor_type}}">Descriptors {{descriptor_type}}</a></li>
    <li>Create Descriptor</li>
{% endblock %}

{% block content_body %}
  	{{ block.super }}
<div class="box">
    {% csrf_token %}
        <div class="box-header with-border">
                  <h3 class="box-title">Create new {{descriptor_type}} descriptor</h3>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-12">
                    <div class="nav-tabs-custom">
                    <ul class="nav nav-tabs">
                        <li class="active" id="yaml_li"><a href="#yaml" data-toggle="tab"><i class="fa fa-file-code-o"></i> YAML</a></li>
                        <li id="json_li"><a href="#json" data-toggle="tab"><i class="fa fa-file-code-o"></i> JSON</a></li>
                        <li id="file_li"><a href="#upload" data-toggle="tab"><i class="fa fa-file-code-o"></i> Upload File</a></li>
                        <li class="pull-right"><button type="button" class="btn btn-block btn-primary btn-sm" data-toggle="modal" data-target="#myModalSave" onclick="create()"><i class="fa fa-save"></i> Create</button></li>
                    </ul>
                    <div class="tab-content">
                        <!-- /.tab-pane -->
                        <div class="tab-pane" id="yaml">
                            <textarea id="code_editor_yaml">

                            </textarea>
                        </div>
                        <!-- /.tab-pane-->

                        <div class="tab-pane" id="json">
                            <textarea id="code_editor_json">

                            </textarea>
                        </div>

                        <div class="tab-pane" id="upload">
                            <div class="form-group" id="files_form" style="">
                                <label for="files_input">Select Project Descriptor Files</label>
                                <input type="file" id="files_input" multiple webkitdirectory onchange="handleFiles(this.files)">

                                <table class="table table-condensed">
                                    <tbody id="file_table_body">
                                    <tr>
                                        <th></th>
                                        <th>File Name</th>
                                        <th>Size</th>
                                        <th>Type</th>
                                    </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                        <!-- /.tab-pane -->
                    </div>
                    <!-- /.tab-content -->




                </div>

                    </div>
                </div>
                 </div>

                    </div>
                </div>

<!-- /.box-body -->


{% endblock %}

{% block resource_block %}
  	{{ block.super }}

    <script src="{% static "topology3D/js/lib/jquery-ui.js" %}"></script>


    <script src="{% static "AdminLTE/plugins/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "AdminLTE/plugins/datatables/dataTables.bootstrap.min.js" %}"></script>


    <script src="{% static "codemirror/lib/codemirror.js" %}"></script>
    <script src="{% static "codemirror/lib/formatting.js" %}"></script>
    <script src="{% static "codemirror/addon/fold/foldcode.js" %}"></script>
    <script src="{% static "codemirror/addon/fold/foldgutter.js" %}"></script>
    <script src="{% static "codemirror/addon/fold/brace-fold.js" %}"></script>
    <script src="{% static "codemirror/mode/javascript/javascript.js" %}"></script>
    <script src="{% static "codemirror/mode/xml/xml.js" %}"></script>
    <script src="{% static "codemirror/mode/markdown/markdown.js" %}"></script>
    <script src="{% static "codemirror/addon/search/searchcursor.js" %}"></script>
    <script src="{% static "codemirror/addon/search/search.js" %}"></script>
    <script src="{% static "codemirror/addon/dialog/dialog.js" %}"></script>
    <script src="{% static "codemirror/addon/edit/matchbrackets.js" %}"></script>
    <script src="{% static "codemirror/addon/edit/closebrackets.js" %}"></script>
    <script src="{% static "codemirror/addon/display/fullscreen.js" %}"></script>
    <script src="{% static "codemirror/keymap/sublime.js" %}"></script>

    <!-- d3.js -->
    <script src="{% static "d3/d3.js" %}" charset="utf-8"></script>

    <!-- Select2 -->
    <script src="{% static "AdminLTE/plugins/select2/select2.full.min.js" %}"></script>

    <script>

    function handleFiles(files){
        console.log(files);
        $('#file_table_body').empty()
        for (var i = 0; i < files.length; i++) {
            console.log(i, files[i].size)
            var file = files[i];
            if (files[i].type == "application/json" || files[i].type == "") {
              $('#file_table_body')
                .append($('<tr>')
                  //.append('<td><a href="javascript:removeFile(' + i + ')"><i class="fa fa-remove"></i></a></td>')
                  .append('<td><i class="fa fa-remove"></i></td>')
                  .append('<td>' + files[i].name + '</td>')
                  .append('<td>' + files[i].size + '</td>')
                  .append('<td>JSON</td>'))
            }
            else{

            }

          }
    }



    var json_editor_settings = {
            mode: "javascript",
            showCursorWhenSelecting: true,
            autofocus: true,
            lineNumbers: true,
            lineWrapping: true,
            foldGutter: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            autoCloseBrackets: true,
            matchBrackets: true,
            extraKeys: {
                "F11": function(cm) {
                    cm.setOption("fullScreen", !cm.getOption("fullScreen"));
                },
                "Esc": function(cm) {
                    if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
                },
                "Ctrl-Q": function(cm) {
                    cm.foldCode(cm.getCursor());
                }
            },
            theme: "neat",
            keyMap: "sublime",
        }

    var yaml_editor_settings = {
            mode: "yaml-frontmatter",
            showCursorWhenSelecting: true,
            autofocus: true,
            lineNumbers: true,
            lineWrapping: true,
            foldGutter: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            autoCloseBrackets: true,
            matchBrackets: true,
            extraKeys: {
                "F11": function(cm) {
                    cm.setOption("fullScreen", !cm.getOption("fullScreen"));
                },
                "Esc": function(cm) {
                    if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
                },
                "Ctrl-Q": function(cm) {
                    cm.foldCode(cm.getCursor());
                }
            },
            //theme: "neat",
            keyMap: "sublime",
        }
        var editorJSON;
        $(document).ready(function () {
           //var cmjsoneditor = CodeMirror.fromTextArea(document.getElementById("code_editor"), json_editor_settings);
           var myJsonTextArea = document.getElementById("code_editor_json");
           editorJSON = CodeMirror(function(elt) {
                            myJsonTextArea.parentNode.replaceChild(elt, myJsonTextArea);
                        }, json_editor_settings );

           editorJSON.setValue(JSON.stringify({}, null,"\t"));

           editorJSON.refresh();

        });


        function create(){
            var id = $('.nav-tabs .active').attr('id');
            var type ;
            switch(id) {
                case 'yaml_li':
                    type = 'yaml'
                    break;
                case 'json_li':
                    type = 'json'
                    break;
                case 'file_li':
                    type = 'file'
                    break;
            }
            console.log(type);
        }



    </script>
{% endblock %}