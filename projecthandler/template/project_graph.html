{% extends "base.html" %}

{% load staticfiles %}

{% block head_block %}
  	{{ block.super }}
    	<link rel="stylesheet" href="{% static "topology3D/css/graph_editor_d3js.css" %}">

    <link rel="stylesheet" href="{% static "AdminLTE/plugins/select2/select2.css" %}">
{% endblock %}

{% block left_sidebar %}
    {% include 'project_base_left_sidebar.html' %}
{% endblock %}

{% block breadcrumb_body %}
  	{{ block.super }}
    <li><a href="{% url 'projects:open_project' project_id=project_id %}">Project {{project_id}}</a></li>
    <li>Show Graph</li>

{% endblock %}

{% block content_body %}
  	{{ block.super }}

<div class="row">
    <div id="graph_ed" style="border: 2px #3c8dbc solid;overflow-y: scroll; width: 100%; height: 40;">
        {% include 'topology_toolbar.html' %}
        {% include 'level_handler.html' %}
        <div id="graph_ed_container" style="width: 100%; height: 30%; position:relative;">

        </div>
    </div>
</div>


{% endblock %}

{% block resource_block %}
  	{{ block.super }}
    <script src="{% static "topology3D/js/lib/jquery-ui.js" %}"></script>

    <script src="{% static "topology3D/js/config.js" %}"></script>
    <script src="{% static "topology3D/js/vmmcontroller.js" %}"></script>
    <script src="{% static "topology3D/js/vertex.js" %}"></script>
    <script src="{% static "topology3D/js/domaincontroller/domaincontroller.js" %}"></script>
    <script src="{% static "topology3D/js/domaincontroller/etsimano.js" %}"></script>
    <script src="{% static "topology3D/js/link.js" %}"></script>
    <script src="{% static "topology3D/js/layer.js" %}"></script>
    <script src="{% static "topology3D/js/event.js" %}"></script>
    <script src="{% static "topology3D/js/algebra.js" %}"></script>
    <script src="{% static "topology3D/js/graph_parameters.js" %}"></script>
    <script src="{% static "topology3D/js/edge.js" %}"></script>
    <script src="{% static "topology3D/js/graph_editor_d3js.js" %}"></script>
    <script src="{% static "AdminLTE/plugins/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "AdminLTE/plugins/datatables/dataTables.bootstrap.min.js" %}"></script>



    <!-- d3.js -->
    <script src="{% static "d3/d3.js" %}" charset="utf-8"></script>

    <!-- Select2 -->
    <script src="{% static "AdminLTE/plugins/select2/select2.full.min.js" %}"></script>

    <script>




    var graph_editor = new dreamer.GraphEditor({
        width: window.innerWidth,
        height: window.innerHeight
    });
     /*
    $('#graph_ed_container').droppable({
        drop: function(){
            console.log("droppable");
            graph_editor.addNode();
        }
    });
   */
    var dropZone = document.getElementById('graph_ed_container');
    dropZone.ondrop = function(e) {
        e.preventDefault();
        var nodetype = e.dataTransfer.getData("text/plain");
        if(nodetype){
            graph_editor.addNode({'id':  nodetype + "_" + Date.now(), 'info': { 'type': nodetype } });
        }
      //
    }

    dropZone.ondragover = function(ev) {
        console.log("ondragover");
        return false;
    }

    dropZone.ondragleave = function() {
        console.log("ondragleave");
        return false;
    }

    function handleForce(el){
        console.log("handleForce", JSON.stringify(el.id));

            graph_editor.handleForce((el.id == "topology_play")? true: false);

    }
    $(document).ready(function () {
        for (var nsd in level){
              console.log(nsd)
             $("#ns_dropdown").append('<li><a '+"id="+nsd +' onclick="nsChange(this.id)">'+nsd+'</a></li>');
         }
     });
    </script>
{% endblock %}

