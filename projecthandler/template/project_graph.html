{% extends "base.html" %}

{% load staticfiles %}

{% block head_block %}
  	{{ block.super }}
    	<link rel="stylesheet" href="{% static "topology3D/css/graph_editor_d3js.css" %}">

    <link rel="stylesheet" href="{% static "AdminLTE/plugins/select2/select2.css" %}">
{% endblock %}

{% block left_sidebar %}
    {% include 'project_base_left_sidebar.html' %}
{% endblock %}

{% block breadcrumb_body %}
  	{{ block.super }}
    <li><a href="{% url 'projects:open_project' project_id=project_id %}">Project {{project_id}}</a></li>
    <li>Show Graph</li>

{% endblock %}

{% block content_body %}
  	{{ block.super }}

<div class="row">
    <div id="graph_ed" style="border: 2px #3c8dbc solid;overflow-y: scroll; width: 100%; height: 40;">
        {% include 'topology_toolbar.html' %}
        {% include 'level_handler.html' %}
        <div id="graph_ed_container" style="width: 100%; height: 30%; position:relative;">

        </div>
    </div>
</div>

{% include 'modals/edit_descriptor.html' %}

{% endblock %}

{% block resource_block %}
  	{{ block.super }}
    <script src="{% static "topology3D/js/lib/jquery-ui.js" %}"></script>

    <script src="{% static "topology3D/js/config.js" %}"></script>
    <script src="{% static "topology3D/js/vmmcontroller.js" %}"></script>
    <script src="{% static "topology3D/js/vertex.js" %}"></script>
    <script src="{% static "topology3D/js/domaincontroller/domaincontroller.js" %}"></script>
    <script src="{% static "topology3D/js/domaincontroller/etsimano.js" %}"></script>
    <script src="{% static "topology3D/js/link.js" %}"></script>
    <script src="{% static "topology3D/js/layer.js" %}"></script>
    <script src="{% static "topology3D/js/event.js" %}"></script>
    <script src="{% static "topology3D/js/algebra.js" %}"></script>
    <script src="{% static "topology3D/js/graph_parameters.js" %}"></script>
    <script src="{% static "topology3D/js/edge.js" %}"></script>
    <script src="{% static "topology3D/js/graph_editor_d3js.js" %}"></script>
    <script src="{% static "AdminLTE/plugins/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "AdminLTE/plugins/datatables/dataTables.bootstrap.min.js" %}"></script>



    <!-- d3.js -->
    <script src="{% static "d3/d3.js" %}" charset="utf-8"></script>

    <!-- Select2 -->
    <script src="{% static "AdminLTE/plugins/select2/select2.full.min.js" %}"></script>

    <script>
    var level =  {"NSExample": {"vnf": ["vnf1", "vnf2", "vnf3"], "vnffg": ["vnffg1"], "vl": ["vl1", "vl2", "vl3", "vl4"]}};

    function nsChange(e){
    $("#ns_button").text(e);
    $("#vnf_dropdown").empty()
    if(level[e].vnf){
       for(var i in level[e].vnf){
         $("#vnf_dropdown").append('<li><a '+"id="+level[e].vnf[i] +' onclick="vnfChange(this.id)">'+level[e].vnf[i]+'</a></li>');
       }
       $("#vnf_dropdown").append('<li><a id="None" onclick="vnfChange(this.id)">None</a></li>');
    }
    $("#vl_dropdown").empty()
    if(level[e].vl){
       for(var i in level[e].vl){
         $("#vl_dropdown").append('<li><a '+"id="+level[e].vl[i] +' onclick="vlChange(this.id)">'+level[e].vl[i]+'</a></li>');
       }
       $("#vl_dropdown").append('<li><a id="None" onclick="vlChange(this.id)">None</a></li>');
    }
    $("#vnffg_dropdown").empty()
    if(level[e].vnffg){
       for(var i in level[e].vnffg){
         $("#vnffg_dropdown").append('<li><a '+"id="+level[e].vnffg[i] +' onclick="vnffgChange(this.id)">'+level[e].vnffg[i]+'</a></li>');
       }
       $("#vnffg_dropdown").append('<li><a id="None" onclick="vnffgChange(this.id)">None</a></li>');
    }
}

function vnfChange(e){
    if(e==='None'){
        $("#vnf_button").text("VNF");
    }else{
        $("#vnf_button").text(e);
    }
    console.log('vnfChange ',e)
}

function vlChange(e){
    if(e==='None'){
        $("#vl_button").text("VL");
    }else{
        $("#vl_button").text(e);
    }
    console.log('vlChange ',e)
}

function vnffgChange(e){
    if(e==='None'){
        $("#vnffg_button").text("VNFFG");
    }else{
        $("#vnffg_button").text(e);
    }
    console.log('vnffgChange ',e)
}



    var graph_editor = new dreamer.GraphEditor({
        width: window.innerWidth,
        height: window.innerHeight
    });
     /*
    $('#graph_ed_container').droppable({
        drop: function(){
            console.log("droppable");
            graph_editor.addNode();
        }
    });
   */
    var dropZone = document.getElementById('graph_ed_container');
    dropZone.ondrop = function(e) {
        e.preventDefault();
        var nodetype = e.dataTransfer.getData("text/plain");
        if(nodetype){
            graph_editor.addNode({'id':  nodetype + "_" + Date.now(), 'info': { 'type': nodetype } });
        }
      //
    }

    dropZone.ondragover = function(ev) {
        console.log("ondragover");
        return false;
    }

    dropZone.ondragleave = function() {
        console.log("ondragleave");
        return false;
    }

    function handleForce(el){
        console.log("handleForce", JSON.stringify(el.id));

            graph_editor.handleForce((el.id == "topology_play")? true: false);

    }
    $(document).ready(function () {

        for (var nsd in level){
              console.log(nsd)
             $("#ns_dropdown").append('<li><a '+"id="+nsd +' onclick="nsChange(this.id)">'+nsd+'</a></li>');
         }

         graph_editor.addListener("node_selected", function(a, args){
            //console.log("node_selected", a, args);
            $('#modal_edit_descriptor').modal('show');
         });
     });
    </script>
{% endblock %}

